buildscript {
    repositories {
      	mavenLocal()
        jcenter()
        mavenCentral()
        maven {
            name = "forge"
            url = "https://files.minecraftforge.net/maven"
        }        
        maven {
            name = 'gradle'
            url 'https://plugins.gradle.org/m2/'
        }
    }
    dependencies {
        classpath 'net.minecraftforge.gradle:ForgeGradle:2.3-SNAPSHOT'
    }
}

plugins {
	id "com.matthewprenger.cursegradle" version "1.4.0"
    id "com.wynprice.cursemaven" version "2.1.1"
    id 'com.github.kt3k.coveralls' version '2.8.2'
    id 'maven-publish'
    id 'maven'
}

apply plugin: 'net.minecraftforge.gradle.forge'

loadProperties()

version = config.mod_version
group = "net.rom"
archivesBaseName = "Exoplanets"
sourceCompatibility = 1.8
targetCompatibility = 1.8


def loadProperties() {
    // Config file with custom properties
    ext.configFile = file "build.properties"
    configFile.withReader {
        def prop = new Properties()
        prop.load(it)
        ext.config = new ConfigSlurper().parse prop
    }

    // grab buildNumber
    ext.buildnumber = "DEV" // this will be referenced as simply project.buildnumber from now on.
    if (System.getenv().BUILD_NUMBER)
        project.buildnumber = System.getenv().BUILD_NUMBER
    if (System.getenv().TRAVIS_BUILD_NUMBER)
        project.buildnumber = System.getenv().TRAVIS_BUILD_NUMBER
    if (System.getenv().CI) {
        //project.buildnumber += "-DEV"
    }

    if (System.getenv().RELEASE || System.getenv().TRAVIS_TAG)
        project.buildnumber = "RELEASE"
    logger.lifecycle "BUILDING VERSION: " + project.buildnumber
}

eclipse.project {
  buildCommand 'org.eclipse.buildship.core.gradleprojectbuilder'
  natures 'org.eclipse.buildship.core.gradleprojectnature'
}

apply from: 'gradle/artifacts.gradle'
apply from: 'gradle/forge.gradle'
apply from: 'gradle/publish.gradle'
apply from: 'gradle/secret.gradle'
apply from: 'gradle/signing.gradle'
apply from: 'gradle/changelog.gradle'


curseforge {

    apiKey = project.hasProperty('authCurse')

    project {
        id = "${config.cf_project_id}"
        releaseType = "${config.release_type}"
        changelog = getGitChangelog
        changelogType = 'markdown'
        addGameVersion "${config.cf_versions}"
        
    	relations {
            requiredLibrary "${config.cf_required}"
    		}

        addArtifact(sourcesJar)
        addArtifact(javadocJar)
        addArtifact(deobfJar)
    }
}